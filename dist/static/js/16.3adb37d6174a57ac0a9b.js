webpackJsonp([16],{523:function(e,t,a){a(877);var o=a(203)(a(879),a(880),null,null);e.exports=o.exports},877:function(e,t,a){var o=a(878);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);a(205)("4bd758fa",o,!0)},878:function(e,t,a){t=e.exports=a(204)(!1),t.push([e.i,".rad-group{margin-bottom:20px}.handle-input{width:300px;display:inline-block}.handle-box2{display:inline-block;float:right}.orange{color:#eb9e05;background-color:transparent}.btn2{margin-bottom:5px;margin-left:0}.diainp{width:217px}.upload-demo .el-upload:hover{border-color:#409eff}",""])},879:function(e,t,a){"use strict";function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:function(){return{user_type:1,user_account:"",uploadUrl:"api/devunit/manage/add",isShow:"1"!=localStorage.getItem("userMsg"),dialogFormVisible:!1,editRowId:"-1",editColumnKey:"-1",radio3:"全部",form:{gateway_sn:"",gateway_vendor:"",devunit_name:"",file_name:"",dev_cn_name:"",channel_name:"",project_name:"",device_image:"",comment:""},rules:{gateway_sn:[{required:!0,message:"请输入网关标识",trigger:"blur"}],devunit_name:[{required:!0,message:"请输入数据库中定义的设备字段",trigger:"blur"}],dev_cn_name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],project_name:[{required:!0,message:"请输入所属项目",trigger:"blur"}]},formLabelWidth:"120px",fileList:[],loading:!1,deviceListData:[],listDataUpdate:[],prjOwnerList:[],vendorList:{1:"爱德佳创",2:"物通博联",3:"金大万翔"},pageTotal:2,currentPage:1,page_size:10}},created:function(){this.user_type=localStorage.getItem("user_type"),this.user_account=localStorage.getItem("user_account"),this.getDeviceList(this.currentPage,this.page_size),this.getProjectArray({user_account:this.user_account})},methods:{getDeviceList:function(e,t){var a=this,o={page_size:t,current_page:e};a.loading=!0,a.$axios.post("/api/devunit/manage/page/list",o).then(function(e){a.loading=!1,console.log(e),0==e.data.ret_code?(a.deviceListData=e.data.extra,a.listDataUpdate=[],a.pageTotal=e.data.total,console.log("self.pageTotal"+a.pageTotal)):(a.deviceListData=[],a.listDataUpdate=[],a.$message.error(e.data.ret_msg))})},getProjectArray:function(e){var t=this;t.loading=!0,t.$axios.post("/api/project/manage/array",e).then(function(e){t.loading=!1,0==e.data.ret_code?t.prjOwnerList=e.data.extra:(t.prjOwnerList=[],t.$message.error(e.data.ret_msg))})},handleCurrentChange:function(e){this.currentPage=e,this.getDeviceList(this.currentPage,this.page_size)},clickDialogBtn:function(){this.form.dev_cn_name="",this.dialogFormVisible=!0},clickDialogSaveBtn:function(e,t){console.log(e+"====="+t);var a=this;this.listDataUpdate[0]=this.deviceListData[t],console.log(this.listDataUpdate);var o={list_data:this.listDataUpdate};a.loading=!0,a.$axios.post("api/devunit/manage/update",o).then(function(e){a.loading=!1,0==e.data.ret_code?(a.$alert("保存成功，刷新页面","修改",{confirmButtonText:"确定",callback:function(e){a.getDeviceList(1,10)}}),a.listDataUpdate=[],a.editRowId="-1",a.editColumnKey="-1"):a.$message.error(e.data.ret_msg)},function(e){a.$message.error("修改失败"),a.loading=!1,console.log(e)})},delDevice:function(e,t,a){var o=this,n=this,l={_id:e,dev_cn_name:t};this.$confirm("确定要删除当前设备？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){o.$axios.post("api/devunit/manage/del",l).then(function(e){n.loading=!1,0==e.data.ret_code?(n.$message({message:"删除成功",type:"success"}),n.deviceListData.splice(a,1)):n.$message.error(e.data.ret_msg)},function(e){n.$message.error("删除失败"),n.loading=!1,console.log(e)})}).catch(function(e){})},submitUpload:function(e){var t;console.log("[devicemanage] submitUpload",e);var a=this,n=(t={gateway_sn:e.gateway_sn,gateway_vendor:e.gateway_vendor,devunit_name:e.devunit_name,dev_cn_name:e.dev_cn_name},o(t,"devunit_name",e.devunit_name),o(t,"project_name",e.project_name),o(t,"comment",e.comment),t);a.loading=!0,a.$axios.post("api/devunit/manage/add",n).then(function(e){a.loading=!1,0==e.data.ret_code?(a.$message({message:"添加成功",type:"success"}),a.dialogFormVisible=!1,a.getDeviceList(1,10)):a.$message.error(e.data.ret_msg)},function(e){a.$message.error("删除失败"),a.loading=!1,console.log(e)})},beforeUpload:function(e){return console.log("[devicemanage] beforeUpload",e.name),!0},handleEdit:function(e,t){console.log("handleEdit"),console.log("[devicemanage] handleEdit:",t._id,e,t[e]),console.log();for(var a=0;a<this.listDataUpdate.length;a++)if(this.listDataUpdate[a]._id==t._id){this.listDataUpdate[a][e]=t[e],console.log("listDataUpdate[i]:",this.listDataUpdate[a]);break}if(a>=this.listDataUpdate.length){var o={};o._id=t._id,o[e]=t[e],this.listDataUpdate.push(o),console.log("new obj:",o)}},handleCellDbClick:function(e,t){console.log(e),console.log("[devicemanage] handleCellDbClick:",e[t.property],t.property)},handleRowClick:function(e,t,a){console.log(a.property),this.editRowId=e._id,console.log("[devicemanage] handleRowClick",e[a.property],a.property)},handRowleave:function(e,t){console.log(t),this.editRowId="",this.getDeviceList(1,10)}},computed:{}}},880:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table",on:{contextmenu:function(e){e.preventDefault()}}},[e.isShow?a("div",{staticClass:"handle-box rad-group"},[a("el-button",{staticClass:"handle-del mr10",attrs:{type:"primary",icon:"plus"},on:{click:e.clickDialogBtn}},[e._v("添加设备")])],1):e._e(),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.deviceListData,border:""},on:{"row-contextmenu":e.handRowleave,"row-click":e.handleRowClick}},[a("el-table-column",{attrs:{prop:"dev_cn_name",label:"设备名称",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.editRowId==t.row._id?a("el-input",{attrs:{size:"small"},model:{value:t.row.dev_cn_name,callback:function(a){e.$set(t.row,"dev_cn_name",a)},expression:"scope.row.dev_cn_name"}}):a("span",[e._v(e._s(t.row.dev_cn_name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"gateway_sn",label:"设备标识",width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.editRowId==t.row._id?a("el-input",{attrs:{size:"small"},model:{value:t.row.gateway_sn,callback:function(a){e.$set(t.row,"gateway_sn",a)},expression:"scope.row.gateway_sn"}}):a("span",[e._v(e._s(t.row.gateway_sn))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"devunit_name",label:"设备字段",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.editRowId==t.row._id?a("el-input",{attrs:{size:"small"},model:{value:t.row.devunit_name,callback:function(a){e.$set(t.row,"devunit_name",a)},expression:"scope.row.devunit_name"}}):a("span",[e._v(e._s(t.row.devunit_name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"project_name",label:"所属项目",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.editRowId==t.row._id?a("el-select",{attrs:{size:"small"},model:{value:t.row.project_name,callback:function(a){e.$set(t.row,"project_name",a)},expression:"scope.row.project_name"}},e._l(e.prjOwnerList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})):a("span",[e._v(e._s(t.row.project_name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"gateway_vendor",label:"网关厂商",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.editRowId==t.row._id?a("el-select",{model:{value:t.row.gateway_vendor,callback:function(a){e.$set(t.row,"gateway_vendor",a)},expression:"scope.row.gateway_vendor"}},e._l(e.vendorList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})):a("span",[e._v(e._s(t.row.gateway_vendor))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"device_status",label:"设备状态",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s("normal"==t.row.device_status?"显示":"隐藏"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"update_time",label:"创建时间",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"comment",label:"备注说明"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.editRowId==t.row._id?a("el-input",{attrs:{size:"small"},model:{value:t.row.comment,callback:function(a){e.$set(t.row,"comment",a)},expression:"scope.row.comment"}}):a("span",[e._v(e._s(t.row.comment))])]}}])}),e._v(" "),e.isShow?a("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"btn1",attrs:{type:"primary",size:"small"},on:{click:function(a){e.delDevice(t.row._id,t.row.dev_cn_name,t.$index)}}},[e._v("删除")]),e._v(" "),a("el-button",{staticClass:"btn1",attrs:{type:"primary",size:"small"},on:{click:function(a){e.clickDialogSaveBtn(t.row._id,t.$index)}}},[e._v("修改")])]}}])}):e._e()],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":e.currentPage,layout:"prev, pager, next",total:e.pageTotal},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{staticClass:"digcont",attrs:{title:"添加设备",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:"网关厂商","label-width":e.formLabelWidth}},[a("el-radio-group",{model:{value:e.form.gateway_vendor,callback:function(t){e.$set(e.form,"gateway_vendor",t)},expression:"form.gateway_vendor"}},e._l(e.vendorList,function(e){return a("el-radio",{key:e,attrs:{label:e,value:e}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"设备中文名称",prop:"dev_cn_name","label-width":e.formLabelWidth}},[a("el-input",{staticClass:"diainp",attrs:{"auto-complete":"off"},model:{value:e.form.dev_cn_name,callback:function(t){e.$set(e.form,"dev_cn_name",t)},expression:"form.dev_cn_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"网关标识",prop:"gateway_sn","label-width":e.formLabelWidth}},[a("el-input",{staticClass:"diainp",attrs:{"auto-complete":"off"},model:{value:e.form.gateway_sn,callback:function(t){e.$set(e.form,"gateway_sn",t)},expression:"form.gateway_sn"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"数据库设备字段",prop:"devunit_name","label-width":e.formLabelWidth}},[a("el-input",{staticClass:"diainp",attrs:{"auto-complete":"off"},model:{value:e.form.devunit_name,callback:function(t){e.$set(e.form,"devunit_name",t)},expression:"form.devunit_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备所属项目",prop:"project_name","label-width":e.formLabelWidth}},[a("el-select",{attrs:{placeholder:"请选择设备所属项目"},model:{value:e.form.project_name,callback:function(t){e.$set(e.form,"project_name",t)},expression:"form.project_name"}},e._l(e.prjOwnerList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"备注说明",prop:"comment","label-width":e.formLabelWidth}},[a("el-input",{staticClass:"diainp",attrs:{"auto-complete":"off"},model:{value:e.form.comment,callback:function(t){e.$set(e.form,"comment",t)},expression:"form.comment"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitUpload(e.form)}}},[e._v("添 加")])],1)],1)],1)},staticRenderFns:[]}}});